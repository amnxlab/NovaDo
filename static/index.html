<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaDo - Smart Task Management</title>
    <!-- Early theme application to prevent flash of unstyled content -->
    <script>
        (function () {
            var theme = localStorage.getItem('theme') || 'midnight-minimal';
            document.documentElement.dataset.theme = theme;

            // Determine if light theme
            var isLightTheme = ['light', 'classic-productivity', 'pastel-calm', 'warm-earth', 'crisp-nordic', 'energetic-sunrise'].includes(theme);
            var bgColor = isLightTheme ? '#ffffff' : '#0f172a';

            // Immediately set loading screen background based on theme
            var loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.backgroundColor = bgColor;
                loadingScreen.style.background = bgColor;
            }

            // Set body and html background immediately
            document.body.style.backgroundColor = bgColor;
            document.documentElement.style.backgroundColor = bgColor;

            // BULLETPROOF FAILSAFE: Force hide loading screen after 8 seconds
            // This runs immediately and will work even if all other JS fails
            setTimeout(function () {
                var ls = document.getElementById('loading-screen');
                if (ls && !ls.classList.contains('hidden')) {
                    console.error('[FAILSAFE] Force hiding loading screen after 8 seconds');
                    ls.style.display = 'none';
                    ls.classList.add('hidden');
                    // Show auth screen as fallback
                    var auth = document.getElementById('auth-screen');
                    if (auth) auth.classList.remove('hidden');
                }
            }, 8000);
        })();
    </script>
    <!-- Critical CSS to prevent white flash on loading screen -->
    <style>
        /* Prevent white flash - set immediately before other CSS loads */
        html,
        body {
            background-color: #0f172a !important;
            margin: 0;
            padding: 0;
        }

        #loading-screen {
            background-color: #0f172a !important;
            background: #0f172a !important;
            position: fixed !important;
            inset: 0 !important;
            z-index: 2000 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        /* Allow hidden class to override display */
        #loading-screen.hidden {
            display: none !important;
        }

        /* Apply theme-based background once theme is detected */
        [data-theme="light"] #loading-screen,
        [data-theme="classic-productivity"] #loading-screen,
        [data-theme="pastel-calm"] #loading-screen,
        [data-theme="warm-earth"] #loading-screen,
        [data-theme="crisp-nordic"] #loading-screen,
        [data-theme="energetic-sunrise"] #loading-screen {
            background-color: #ffffff !important;
            background: #ffffff !important;
        }
    </style>
    <link rel="stylesheet" href="css/themes.css?v=4">
    <link rel="stylesheet" href="css/style.css?v=17">
    <link rel="stylesheet" href="css/taskMatrix.css?v=10">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Lucide Icons (modern, lightweight SVG icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js for statistics visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Canvas Confetti for dopamine bursts -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>

<body>
    <div id="app">
        <!-- Loading Screen removed - was causing freeze issues -->
        <div id="loading-screen" class="hidden"></div>

        <!-- Auth Screen -->
        <div id="auth-screen" class="screen hidden">
            <div class="auth-container">
                <div class="auth-header">
                    <div class="logo">
                        <img src="logo.png" alt="NovaDo" class="logo-icon-img">
                        <span class="logo-text">NovaDo</span>
                    </div>
                    <p class="tagline">Smart Task Management</p>
                </div>

                <div class="auth-tabs">
                    <button class="tab-btn active" data-tab="login">Sign In</button>
                    <button class="tab-btn" data-tab="register">Sign Up</button>
                </div>

                <!-- Login Form -->
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                    <div id="login-error" class="error-message"></div>
                </form>

                <!-- Register Form -->
                <form id="register-form" class="auth-form hidden">
                    <div class="form-group">
                        <label for="register-name">Name</label>
                        <input type="text" id="register-name" placeholder="Your name" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Account</button>
                    <div id="register-error" class="error-message"></div>
                </form>
            </div>
        </div>

        <!-- Main App Screen -->
        <div id="main-screen" class="screen hidden">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <img src="logo.png" alt="NovaDo" class="logo-icon-img">
                        <span class="logo-text">NovaDo</span>
                    </div>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-section" data-section="smart-lists">
                        <h3>
                            Smart Lists
                            <button class="btn-icon section-add-btn" data-section="smart-lists"
                                title="Add Smart List">+</button>
                        </h3>
                        <ul id="smart-lists"></ul>
                    </div>

                    <div class="nav-section" data-section="workspace">
                        <h3>
                            Workspace
                            <button class="btn-icon" id="add-tag-btn" title="Add Tag">+</button>
                        </h3>
                        <ul id="tags-tree"></ul>
                    </div>

                    <div class="nav-section" data-section="tools">
                        <h3>
                            Tools
                            <button class="btn-icon section-add-btn" data-section="tools" title="Add Tool">+</button>
                        </h3>
                        <ul id="tools-list"></ul>
                    </div>

                    <div class="nav-section" data-section="task-status">
                        <h3>
                            Task Status
                            <button class="btn-icon section-add-btn" data-section="task-status"
                                title="Add Status">+</button>
                        </h3>
                        <ul id="task-status-list"></ul>
                    </div>
                </nav>

                <div class="sidebar-footer">
                    <div class="user-info" id="user-info">
                        <span class="user-avatar">üë§</span>
                        <span class="user-name"></span>
                    </div>
                    <button class="btn-icon" id="settings-btn" title="Settings">‚öôÔ∏è</button>
                    <button class="btn-icon" id="logout-btn" title="Logout">üö™</button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <header class="main-header">
                    <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <h1 id="current-view-title">Inbox</h1>
                    <div class="header-actions">
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="Search tasks...">
                        </div>
                        <button class="btn btn-icon sync-btn" id="sync-calendar-btn"
                            title="Sync with Google Calendar (Ctrl+Shift+S)">
                            <svg class="sync-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" />
                                <path d="M21 3v5h-5" />
                            </svg>
                        </button>
                        <button class="btn btn-primary" id="add-task-btn">
                            <span>+</span> New Task
                        </button>
                    </div>
                </header>

                <!-- Tasks View -->
                <div id="tasks-view" class="view">
                    <div class="quick-add-task" id="quick-add-task">
                        <span class="add-icon">+</span>
                        <input type="text" id="quick-task-input" placeholder="Add a task...">
                    </div>
                    <div id="tasks-list" class="tasks-list"></div>
                    <div id="empty-state" class="empty-state hidden">
                        <div class="empty-icon">üìù</div>
                        <h3>No tasks yet</h3>
                        <p>Press Enter to add your first task</p>
                    </div>
                </div>

                <!-- Habits View -->
                <div id="habits-view" class="view hidden">
                    <div class="habits-container">
                        <div class="habits-header">
                            <div class="habits-header-content">
                                <div class="habits-title-section">
                                    <h2 class="habits-page-title">Habits</h2>
                                    <p class="habits-page-subtitle">Track your daily routines and build consistency</p>
                                </div>
                                <button class="btn btn-primary btn-icon-left" id="add-habit-btn">
                                    <i data-lucide="plus"></i>
                                    <span>New Habit</span>
                                </button>
                            </div>
                        </div>
                        <div id="habits-list" class="habits-list"></div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendar-view" class="view hidden">
                    <div class="calendar-toolbar">
                        <div class="calendar-nav">
                            <button class="btn-icon" id="prev-period">‚óÄ</button>
                            <h2 id="calendar-month"></h2>
                            <button class="btn-icon" id="next-period">‚ñ∂</button>
                            <button class="btn btn-secondary" id="today-btn">Today</button>
                        </div>
                        <div class="calendar-view-modes">
                            <button class="view-mode-btn" data-mode="day">Day</button>
                            <button class="view-mode-btn" data-mode="week">Week</button>
                            <button class="view-mode-btn active" data-mode="month">Month</button>
                            <button class="view-mode-btn" data-mode="agenda">Agenda</button>
                        </div>
                    </div>
                    <div class="calendar-container">
                        <div class="calendar-grid" id="calendar-grid"></div>
                        <div class="calendar-day-view hidden" id="calendar-day-view"></div>
                        <div class="calendar-week-view hidden" id="calendar-week-view"></div>
                        <div class="calendar-agenda-view hidden" id="calendar-agenda-view"></div>
                    </div>
                </div>

                <!-- Pomodoro View -->
                <div id="pomodoro-view" class="view hidden">
                    <div class="pomo-split-layout">
                        <!-- Left Panel: Timer -->
                        <div class="pomo-timer-panel">
                            <div class="pomo-mode-tabs">
                                <button class="pomo-tab active" data-mode="pomo">Pomo</button>
                                <button class="pomo-tab" data-mode="stopwatch">Stopwatch</button>
                            </div>

                            <div class="pomo-task-selector">
                                <select id="pomo-task-select">
                                    <option value="">Select a task...</option>
                                </select>
                                <span class="pomo-task-arrow">‚Ä∫</span>
                            </div>

                            <div class="pomo-timer-ring">
                                <svg viewBox="0 0 200 200">
                                    <circle class="timer-bg" cx="100" cy="100" r="90" />
                                    <circle class="timer-progress" id="timer-progress" cx="100" cy="100" r="90"
                                        stroke-dasharray="565" stroke-dashoffset="0" />
                                </svg>
                                <div class="timer-display" id="timer-display">25:00</div>
                            </div>

                            <div class="pomo-action-btns">
                                <button class="btn pomo-btn-primary" id="timer-start">Go On</button>
                                <button class="btn pomo-btn-secondary" id="timer-exit">Exit</button>
                            </div>

                            <div class="pomo-settings-toggle">
                                <button class="btn-icon" id="pomo-settings-btn" title="Settings">‚öôÔ∏è</button>
                            </div>

                            <div class="pomo-settings-panel hidden" id="pomo-settings-panel">
                                <h4>Timer Settings</h4>
                                <div class="pomo-setting">
                                    <label>Focus Duration</label>
                                    <input type="number" id="pomo-work-duration" value="25" min="1" max="60"> min
                                </div>
                                <div class="pomo-setting">
                                    <label>Short Break</label>
                                    <input type="number" id="pomo-short-break" value="5" min="1" max="30"> min
                                </div>
                                <div class="pomo-setting">
                                    <label>Long Break</label>
                                    <input type="number" id="pomo-long-break" value="15" min="1" max="60"> min
                                </div>
                                <div class="pomo-setting">
                                    <label>Sessions before long break</label>
                                    <input type="number" id="pomo-sessions-count" value="4" min="1" max="10">
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel: Stats & History -->
                        <div class="pomo-stats-panel">
                            <h3>Overview</h3>
                            <div class="pomo-stats-grid">
                                <div class="pomo-stat-box">
                                    <div class="stat-label">Today's Pomos</div>
                                    <div class="stat-value" id="today-pomos">0</div>
                                </div>
                                <div class="pomo-stat-box">
                                    <div class="stat-label">Today's Focus Duration</div>
                                    <div class="stat-value" id="today-duration">0<span class="stat-unit">m</span></div>
                                </div>
                                <div class="pomo-stat-box">
                                    <div class="stat-label">Total Pomos</div>
                                    <div class="stat-value" id="total-pomos">0</div>
                                </div>
                                <div class="pomo-stat-box highlight">
                                    <div class="stat-label">Total Focus Duration</div>
                                    <div class="stat-value" id="total-duration">0<span class="stat-unit">h</span> 0<span
                                            class="stat-unit">m</span></div>
                                </div>
                            </div>

                            <div class="pomo-focus-record">
                                <div class="focus-record-header">
                                    <h3>Focus Record</h3>
                                </div>
                                <div class="focus-record-list" id="focus-record-list">
                                    <!-- Focus records will be rendered here -->
                                    <div class="focus-record-empty">No focus sessions yet. Start a timer to begin
                                        tracking!</div>
                                </div>
                            </div>

                            <div class="pomo-tag-stats hidden" id="pomo-tag-stats">
                                <h3>Focus by Tag</h3>
                                <div class="tag-stats-list" id="tag-stats-list">
                                    <!-- Tag stats will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics View -->
                <div id="stats-view" class="view hidden">
                    <div class="stats-container">
                        <!-- Stats Header with View Switcher -->
                        <div class="stats-header">
                            <div class="stats-view-tabs" role="tablist">
                                <button class="stats-tab active" data-view="daily" role="tab" aria-selected="true"
                                    aria-controls="stats-daily-view">
                                    <span class="tab-icon">üåÖ</span>
                                    <span class="tab-label">Daily</span>
                                </button>
                                <button class="stats-tab" data-view="weekly" role="tab" aria-selected="false"
                                    aria-controls="stats-weekly-view">
                                    <span class="tab-icon">üìä</span>
                                    <span class="tab-label">Weekly</span>
                                </button>
                                <button class="stats-tab" data-view="monthly" role="tab" aria-selected="false"
                                    aria-controls="stats-monthly-view">
                                    <span class="tab-icon">üìÖ</span>
                                    <span class="tab-label">Monthly</span>
                                </button>
                                <button class="stats-tab" data-view="gamified" role="tab" aria-selected="false"
                                    aria-controls="stats-gamified-view">
                                    <span class="tab-icon">üéÆ</span>
                                    <span class="tab-label">Gamified</span>
                                </button>
                                <button class="stats-tab" data-view="insights" role="tab" aria-selected="false"
                                    aria-controls="stats-insights-view">
                                    <span class="tab-icon">üí°</span>
                                    <span class="tab-label">Insights</span>
                                </button>
                                <button class="stats-tab" data-view="hyperfocus" role="tab" aria-selected="false"
                                    aria-controls="stats-hyperfocus-view">
                                    <span class="tab-icon">üéØ</span>
                                    <span class="tab-label">Hyperfocus</span>
                                </button>
                            </div>
                            <div class="stats-controls">
                                <button class="btn btn-secondary btn-small" id="stats-export-btn" title="Export Stats">
                                    <span>üì•</span> Export
                                </button>
                                <button class="btn btn-secondary btn-small" id="stats-focus-mode-btn"
                                    title="Toggle Focus Mode">
                                    <span>üëÅÔ∏è</span> Focus Mode
                                </button>
                            </div>
                        </div>

                        <!-- Daily Snapshot View -->
                        <div id="stats-daily-view" class="stats-view-content active" role="tabpanel"
                            aria-labelledby="stats-daily-tab">
                            <div class="daily-snapshot-grid">
                                <div class="daily-metric-card">
                                    <div class="metric-icon">‚è±Ô∏è</div>
                                    <div class="metric-value" id="daily-focus-time">0h</div>
                                    <div class="metric-label">Focus Time</div>
                                </div>
                                <div class="daily-metric-card">
                                    <div class="metric-icon">‚úÖ</div>
                                    <div class="metric-value" id="daily-completed">0</div>
                                    <div class="metric-label">Completed</div>
                                    <canvas id="daily-completed-ring"></canvas>
                                </div>
                                <div class="daily-metric-card">
                                    <div class="metric-icon">üî•</div>
                                    <div class="metric-value" id="daily-streak">0</div>
                                    <div class="metric-label">Day Streak</div>
                                </div>
                                <div class="daily-motivational">
                                    <div class="motivational-avatar" id="daily-avatar">üå±</div>
                                    <div class="motivational-text" id="daily-motivation">Keep going!</div>
                                </div>
                            </div>
                        </div>

                        <!-- Weekly Trends View -->
                        <div id="stats-weekly-view" class="stats-view-content" role="tabpanel"
                            aria-labelledby="stats-weekly-tab">
                            <div class="weekly-trends-container">
                                <div class="trends-chart-container">
                                    <h3>Task Completion Trends</h3>
                                    <canvas id="weekly-line-chart"></canvas>
                                </div>
                                <div class="trends-chart-container">
                                    <h3>Daily Focus Hours</h3>
                                    <canvas id="weekly-bar-chart"></canvas>
                                </div>
                                <div class="ai-insights-panel">
                                    <h3>üí° AI Insights</h3>
                                    <div id="ai-insights-content">
                                        <p class="insight-text">Loading insights...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Analytics View -->
                        <div id="stats-monthly-view" class="stats-view-content" role="tabpanel"
                            aria-labelledby="stats-monthly-tab">
                            <div class="monthly-analytics-container">
                                <div class="analytics-mode-toggle">
                                    <button class="mode-btn active" data-mode="simplified">Simplified</button>
                                    <button class="mode-btn" data-mode="detailed">Detailed</button>
                                </div>
                                <div class="monthly-metrics-grid">
                                    <div class="metric-card-large">
                                        <div class="metric-label">Total Focus Hours</div>
                                        <div class="metric-value-large" id="monthly-focus-hours">0h</div>
                                    </div>
                                    <div class="metric-card-large">
                                        <div class="metric-label">Goal Achievement</div>
                                        <div class="metric-value-large" id="monthly-goal-achievement">0%</div>
                                        <canvas id="monthly-goal-chart"></canvas>
                                    </div>
                                </div>
                                <div class="category-breakdown">
                                    <h3>Category Breakdown</h3>
                                    <canvas id="monthly-category-chart"></canvas>
                                </div>
                                <div class="heatmap-container">
                                    <h3>Activity Heatmap</h3>
                                    <div id="monthly-heatmap"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Gamified Progress View -->
                        <div id="stats-gamified-view" class="stats-view-content" role="tabpanel"
                            aria-labelledby="stats-gamified-tab">
                            <div class="gamified-container">
                                <div class="character-display">
                                    <canvas id="character-canvas" width="200" height="200"></canvas>
                                    <div class="character-level">
                                        <span>Level </span><span id="character-level">1</span>
                                    </div>
                                </div>
                                <div class="badges-section">
                                    <h3>Badges</h3>
                                    <div id="badges-grid" class="badges-grid"></div>
                                </div>
                                <div class="rewards-section">
                                    <h3>Rewards</h3>
                                    <div class="streak-display">
                                        <span class="streak-value" id="gamified-streak">0</span>
                                        <span class="streak-label">Day Streak</span>
                                    </div>
                                    <button class="btn btn-primary" id="celebrate-btn">üéâ Celebrate!</button>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Insight View -->
                        <div id="stats-insights-view" class="stats-view-content" role="tabpanel"
                            aria-labelledby="stats-insights-tab">
                            <div class="insights-container">
                                <!-- Executive Summary -->
                                <div class="executive-summary-card" id="executive-summary">
                                    <p>Loading insights...</p>
                                </div>

                                <!-- Insights Grid - Charts and Widgets -->
                                <div class="insights-grid">
                                    <!-- Productivity Radar -->
                                    <div class="insight-chart-card">
                                        <h3 class="chart-title">Productivity Overview</h3>
                                        <div class="chart-container">
                                            <canvas id="productivity-radar-chart"></canvas>
                                        </div>
                                    </div>

                                    <!-- Hourly Heatmap -->
                                    <div class="insight-chart-card">
                                        <h3 class="chart-title">Peak Hours</h3>
                                        <div id="hourly-heatmap-container"></div>
                                    </div>
                                </div>

                                <!-- AI Recommendations Grid -->
                                <div class="insights-widget-grid" id="insights-widget-grid">
                                    <!-- Widgets will be dynamically added here -->
                                </div>

                                <!-- Pattern Insights -->
                                <div class="ai-pattern-insights">
                                    <h3>Pattern Insights</h3>
                                    <div id="pattern-insights-content">
                                        <p>Analyzing your patterns...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hyperfocus Mode View -->
                        <div id="stats-hyperfocus-view" class="stats-view-content" role="tabpanel"
                            aria-labelledby="stats-hyperfocus-tab">
                            <div class="hyperfocus-container">
                                <div class="hyperfocus-streak">
                                    <div class="hyperfocus-value" id="hyperfocus-streak-value">0</div>
                                    <div class="hyperfocus-label">Day Streak</div>
                                </div>
                                <div class="hyperfocus-goal">
                                    <div class="hyperfocus-goal-text" id="hyperfocus-goal-text">Next Goal: Complete 5
                                        tasks</div>
                                </div>
                                <div class="hyperfocus-progress">
                                    <div class="hyperfocus-progress-bar" id="hyperfocus-progress-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings-view" class="view hidden">
                    <div class="settings-container">
                        <header class="settings-header">
                            <h1>Settings</h1>
                            <p class="settings-subtitle">Manage your account and preferences</p>
                        </header>

                        <!-- Profile Section -->
                        <section class="settings-card">
                            <div class="settings-card-header">
                                <i data-lucide="user"></i>
                                <h2>Profile</h2>
                            </div>
                            <div class="profile-section">
                                <div class="profile-avatar-section">
                                    <div class="profile-avatar" id="profile-avatar">
                                        <img src="" alt="Profile" id="profile-avatar-img" class="hidden">
                                        <span class="avatar-placeholder" id="avatar-placeholder">
                                            <i data-lucide="user"></i>
                                        </span>
                                        <label class="avatar-upload-btn" for="avatar-upload" title="Upload photo">
                                            <i data-lucide="camera"></i>
                                        </label>
                                        <input type="file" id="avatar-upload" accept="image/*" class="hidden">
                                    </div>
                                    <p class="avatar-hint">Click to upload photo</p>
                                </div>
                                <form id="profile-form" class="profile-form">
                                    <div class="form-group">
                                        <label for="settings-name">Display Name</label>
                                        <input type="text" id="settings-name" placeholder="Your name">
                                    </div>
                                    <div class="form-group">
                                        <label for="settings-email">Email</label>
                                        <input type="email" id="settings-email" disabled>
                                        <small class="form-hint">Email cannot be changed</small>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i data-lucide="save"></i> Save Profile
                                    </button>
                                </form>
                            </div>
                        </section>

                        <!-- Appearance Section -->
                        <section class="settings-card">
                            <div class="settings-card-header">
                                <i data-lucide="palette"></i>
                                <h2>Appearance</h2>
                            </div>
                            <p class="settings-description">Choose a color theme for your workspace.</p>
                            <div class="theme-picker">
                                <h4 class="theme-category-title">‚òÄÔ∏è Light Themes</h4>
                                <div class="theme-grid">
                                    <button class="theme-card" data-theme="light" title="Classic">
                                        <div class="theme-preview theme-preview-classic"></div>
                                        <span class="theme-name">Classic</span>
                                    </button>
                                    <button class="theme-card" data-theme="pastel-calm" title="Pastel">
                                        <div class="theme-preview theme-preview-pastel"></div>
                                        <span class="theme-name">Pastel</span>
                                    </button>
                                    <button class="theme-card" data-theme="warm-earth" title="Earth">
                                        <div class="theme-preview theme-preview-earth"></div>
                                        <span class="theme-name">Earth</span>
                                    </button>
                                    <button class="theme-card" data-theme="crisp-nordic" title="Nordic">
                                        <div class="theme-preview theme-preview-nordic"></div>
                                        <span class="theme-name">Nordic</span>
                                    </button>
                                    <button class="theme-card" data-theme="energetic-sunrise" title="Sunrise">
                                        <div class="theme-preview theme-preview-sunrise"></div>
                                        <span class="theme-name">Sunrise</span>
                                    </button>
                                </div>

                                <h4 class="theme-category-title">üåô Dark Themes</h4>
                                <div class="theme-grid">
                                    <button class="theme-card active" data-theme="dark" title="Midnight">
                                        <div class="theme-preview theme-preview-midnight"></div>
                                        <span class="theme-name">Midnight</span>
                                    </button>
                                    <button class="theme-card" data-theme="deep-ocean" title="Ocean">
                                        <div class="theme-preview theme-preview-ocean"></div>
                                        <span class="theme-name">Ocean</span>
                                    </button>
                                    <button class="theme-card" data-theme="charcoal-elegance" title="Charcoal">
                                        <div class="theme-preview theme-preview-charcoal"></div>
                                        <span class="theme-name">Charcoal</span>
                                    </button>
                                    <button class="theme-card" data-theme="neon-pulse" title="Neon">
                                        <div class="theme-preview theme-preview-neon"></div>
                                        <span class="theme-name">Neon</span>
                                    </button>
                                    <button class="theme-card" data-theme="forest-dusk" title="Forest">
                                        <div class="theme-preview theme-preview-forest"></div>
                                        <span class="theme-name">Forest</span>
                                    </button>
                                    <button class="theme-card" data-theme="stormy-void" title="Stormy">
                                        <div class="theme-preview theme-preview-stormy"></div>
                                        <span class="theme-name">Stormy</span>
                                    </button>
                                    <button class="theme-card" data-theme="warm-ember" title="Ember">
                                        <div class="theme-preview theme-preview-ember"></div>
                                        <span class="theme-name">Ember</span>
                                    </button>
                                    <button class="theme-card" data-theme="cyber-twilight" title="Cyber">
                                        <div class="theme-preview theme-preview-cyber"></div>
                                        <span class="theme-name">Cyber</span>
                                    </button>
                                    <button class="theme-card" data-theme="hacker" title="Hacker">
                                        <div class="theme-preview theme-preview-hacker"></div>
                                        <span class="theme-name">Hacker</span>
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- AI Assistant Section -->
                        <section class="settings-card">
                            <div class="settings-card-header">
                                <i data-lucide="bot"></i>
                                <h2>AI Assistant</h2>
                            </div>
                            <p class="settings-description">Enable AI-powered task creation with natural language.</p>
                            <form id="ai-config-form">
                                <div class="form-group">
                                    <label for="llm-provider">Provider</label>
                                    <select id="llm-provider">
                                        <option value="gemini">üåü Google Gemini (Free)</option>
                                        <option value="groq">‚ö° Groq / Llama (Free)</option>
                                        <option value="openai">OpenAI (Paid)</option>
                                    </select>
                                    <small id="provider-help" class="form-hint">Get free API key at <a
                                            href="https://ai.google.dev" target="_blank">ai.google.dev</a></small>
                                </div>
                                <div class="form-group">
                                    <label for="llm-api-key">API Key</label>
                                    <input type="password" id="llm-api-key" placeholder="Paste your API key here">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i data-lucide="key"></i> Configure AI
                                </button>
                                <p id="ai-status" class="status-text"></p>
                            </form>
                        </section>

                        <!-- Google Calendar Section -->
                        <section class="settings-card">
                            <div class="settings-card-header">
                                <i data-lucide="calendar"></i>
                                <h2>Google Calendar</h2>
                            </div>
                            <p class="settings-description">Connect your Google Calendar to automatically import events.
                            </p>
                            <div id="google-calendar-settings">
                                <div id="gcal-not-configured" class="gcal-status hidden">
                                    <div class="status-badge warning">‚ö†Ô∏è Not Configured</div>
                                    <p>Add Google OAuth credentials to .env file.</p>
                                    <a href="https://console.cloud.google.com/apis/credentials" target="_blank"
                                        class="link">Get credentials ‚Üí</a>
                                </div>
                                <div id="gcal-disconnected" class="gcal-status hidden">
                                    <div class="status-badge neutral">Not Connected</div>
                                    <button class="btn btn-primary" id="connect-google-btn">
                                        <span class="google-icon">G</span> Connect Google Calendar
                                    </button>
                                </div>
                                <div id="gcal-connected" class="gcal-status hidden">
                                    <div class="status-badge success">‚úì Connected</div>
                                    <p>Connected as: <strong id="gcal-email"></strong></p>
                                    <div id="gcal-calendars-list" class="gcal-calendars-list hidden">
                                        <label class="gcal-list-label">Select Calendars to Sync:</label>
                                        <div id="gcal-calendars-container" class="gcal-calendars-container"></div>
                                        <button id="save-calendars-btn" class="btn btn-small btn-primary hidden">Save
                                            Selection</button>
                                    </div>
                                    <div class="gcal-actions">
                                        <button class="btn btn-secondary" id="sync-calendar-settings-btn">
                                            <i data-lucide="refresh-cw"></i> Sync Now
                                        </button>
                                        <button class="btn btn-outline danger"
                                            id="disconnect-google-btn">Disconnect</button>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Timezone Section -->
                        <section class="settings-card">
                            <div class="settings-card-header">
                                <i data-lucide="clock"></i>
                                <h2>Timezone</h2>
                            </div>
                            <p class="settings-description">Select your timezone for accurate calendar event times.</p>
                            <div class="setting-row">
                                <div class="setting-info">
                                    <label for="timezone-select">Your Timezone</label>
                                    <p class="setting-hint">Google Calendar events will be displayed in this timezone
                                    </p>
                                </div>
                                <div class="setting-control">
                                    <select id="timezone-select" class="form-select">
                                        <option value="UTC">UTC (Coordinated Universal Time)</option>
                                        <option value="America/New_York">Eastern Time (US)</option>
                                        <option value="America/Chicago">Central Time (US)</option>
                                        <option value="America/Denver">Mountain Time (US)</option>
                                        <option value="America/Los_Angeles">Pacific Time (US)</option>
                                        <option value="America/Anchorage">Alaska Time</option>
                                        <option value="Pacific/Honolulu">Hawaii Time</option>
                                        <option value="Europe/London">London (GMT/BST)</option>
                                        <option value="Europe/Paris">Paris (CET/CEST)</option>
                                        <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                                        <option value="Europe/Moscow">Moscow (MSK)</option>
                                        <option value="Asia/Dubai">Dubai (GST)</option>
                                        <option value="Asia/Kolkata">India (IST)</option>
                                        <option value="Asia/Singapore">Singapore (SGT)</option>
                                        <option value="Asia/Tokyo">Tokyo (JST)</option>
                                        <option value="Asia/Shanghai">Shanghai (CST)</option>
                                        <option value="Australia/Sydney">Sydney (AEST/AEDT)</option>
                                        <option value="Pacific/Auckland">Auckland (NZST/NZDT)</option>
                                        <option value="Africa/Cairo">Cairo (EET)</option>
                                        <option value="Africa/Johannesburg">Johannesburg (SAST)</option>
                                    </select>
                                    <button class="btn btn-secondary btn-small" id="detect-timezone-btn"
                                        title="Detect from browser">
                                        <i data-lucide="locate"></i> Auto-detect
                                    </button>
                                </div>
                            </div>
                            <p class="settings-note" id="timezone-save-status"></p>
                        </section>

                        <!-- Notifications Section -->
                        <section class="settings-card">
                            <div class="settings-card-header">
                                <i data-lucide="bell"></i>
                                <h2>Notifications</h2>
                            </div>
                            <p class="settings-description">Get reminders for tasks, habits, and pomodoro sessions.</p>
                            <div class="notification-settings">
                                <div class="notification-permission">
                                    <span id="notification-status">Permission: <strong
                                            id="notification-permission-state">Unknown</strong></span>
                                    <button class="btn btn-secondary" id="enable-notifications-btn">Enable
                                        Notifications</button>
                                </div>
                                <div class="notification-options">
                                    <label class="toggle-option">
                                        <input type="checkbox" id="notify-task-reminders" checked>
                                        <span class="toggle-label">Task Reminders (30 min before)</span>
                                    </label>
                                    <label class="toggle-option">
                                        <input type="checkbox" id="notify-habit-reminders" checked>
                                        <span class="toggle-label">Habit Reminders</span>
                                    </label>
                                    <label class="toggle-option">
                                        <input type="checkbox" id="notify-pomodoro-alerts" checked>
                                        <span class="toggle-label">Pomodoro Timer Alerts</span>
                                    </label>
                                </div>
                            </div>
                        </section>

                        <!-- Account Section -->
                        <section class="settings-card settings-card-danger">
                            <div class="settings-card-header">
                                <i data-lucide="shield"></i>
                                <h2>Account</h2>
                            </div>
                            <div class="account-actions">
                                <button class="btn btn-outline" onclick="handleLogout()">
                                    <i data-lucide="log-out"></i> Sign Out
                                </button>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Task Matrix View -->
                <div id="matrix-view" class="view hidden">
                    <!-- Banner Section -->
                    <div id="matrix-banner" class="matrix-banner">
                        <div class="banner-image-container">
                            <img id="matrix-banner-image" class="banner-image" src="" alt="Banner">
                            <div id="matrix-banner-default" class="banner-default"></div>
                        </div>
                        <div class="banner-actions">
                            <button class="banner-btn" id="banner-edit-btn" title="Edit Banner">
                                <i data-lucide="image"></i>
                            </button>
                            <button class="banner-btn banner-btn-remove" id="banner-remove-btn" title="Remove Banner">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        <input type="file" id="banner-file-input" accept="image/jpeg,image/png,image/webp,image/gif"
                            style="display: none;">
                    </div>
                    <div id="matrix-header"></div>
                    <div id="matrix-filter-bar"></div>
                    <div id="matrix-view-container"></div>
                </div>
            </main>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="task-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="task-modal-title">New Task</h2>
                <button class="btn-close" id="close-task-modal">&times;</button>
            </div>
            <form id="task-form">
                <input type="hidden" id="task-id">
                <div class="form-group">
                    <label for="task-title">Title</label>
                    <input type="text" id="task-title" placeholder="What needs to be done?" required>
                </div>
                <div class="form-group">
                    <label for="task-description">Description</label>
                    <textarea id="task-description" placeholder="Add details..." rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-due-date">Due Date</label>
                        <input type="date" id="task-due-date">
                    </div>
                    <div class="form-group">
                        <label for="task-due-time">Time</label>
                        <input type="time" id="task-due-time" step="60">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-priority">Priority</label>
                        <select id="task-priority">
                            <option value="0">None</option>
                            <option value="1">Low</option>
                            <option value="2">Medium</option>
                            <option value="3">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-status">Status</label>
                        <select id="task-status">
                            <option value="scheduled">üìÖ Scheduled</option>
                            <option value="in_progress">‚ñ∂Ô∏è In Progress</option>
                            <option value="completed">‚úì Completed</option>
                            <option value="skipped">‚è≠Ô∏è Skipped</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-list">List</label>
                        <select id="task-list"></select>
                    </div>
                    <div class="form-group">
                        <label for="task-tags">Tags (comma separated)</label>
                        <input type="text" id="task-tags" placeholder="work, urgent, project">
                    </div>
                </div>

                <!-- Subtasks/Checklist -->
                <div class="form-group subtasks-section">
                    <label>
                        Subtasks
                        <span class="subtask-progress" id="subtask-progress"></span>
                    </label>
                    <div id="subtasks-list" class="subtasks-list"></div>
                    <div class="subtask-add">
                        <input type="text" id="new-subtask" placeholder="Add a subtask..." class="subtask-input">
                        <button type="button" class="btn btn-small" id="add-subtask-btn">+ Add</button>
                    </div>
                </div>

                <!-- Attachments -->
                <div class="form-group attachments-section">
                    <label>Attachments</label>
                    <div id="attachments-list" class="attachments-list"></div>
                    <div class="attachment-add">
                        <input type="file" id="attachment-input" multiple accept="image/*,.pdf,.doc,.docx,.txt" hidden>
                        <button type="button" class="btn btn-small btn-outline" id="add-attachment-btn">
                            üìé Add File
                        </button>
                    </div>
                </div>

                <!-- Reminder & Sync Options -->
                <div class="form-group sync-options-section">
                    <label>Reminders & Sync</label>
                    <div class="sync-options-grid">
                        <!-- Reminder Toggle -->
                        <div class="sync-option">
                            <label class="toggle-option">
                                <input type="checkbox" id="task-reminder-enabled">
                                <span class="toggle-label">üîî Enable Reminder</span>
                            </label>
                            <div class="reminder-config" id="reminder-config" style="display: none;">
                                <select id="task-reminder-minutes">
                                    <option value="5">5 minutes before</option>
                                    <option value="15">15 minutes before</option>
                                    <option value="30" selected>30 minutes before</option>
                                    <option value="60">1 hour before</option>
                                    <option value="120">2 hours before</option>
                                    <option value="1440">1 day before</option>
                                </select>
                                <div class="reminder-channels">
                                    <label class="checkbox-option">
                                        <input type="checkbox" id="task-reminder-desktop" checked>
                                        <span>üíª Desktop</span>
                                    </label>
                                    <label class="checkbox-option">
                                        <input type="checkbox" id="task-reminder-mobile" checked>
                                        <span>üì± Mobile (via Google Calendar)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Sync to Calendar Toggle -->
                        <div class="sync-option" id="sync-calendar-option">
                            <label class="toggle-option">
                                <input type="checkbox" id="task-sync-calendar">
                                <span class="toggle-label">üìÖ Sync to Google Calendar</span>
                            </label>
                            <p class="sync-hint" id="sync-calendar-hint">Task will appear in your Google Calendar with
                                notifications</p>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-task">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- List Modal -->
    <div id="list-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>New List</h2>
                <button class="btn-close" id="close-list-modal">&times;</button>
            </div>
            <form id="list-form">
                <div class="form-group">
                    <label for="list-name">List Name</label>
                    <input type="text" id="list-name" placeholder="My Workspace" required>
                </div>
                <div class="form-group">
                    <label for="list-color">Color</label>
                    <input type="color" id="list-color" value="#6366f1">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-list">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create List</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Habit Modal -->
    <div id="habit-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>New Habit</h2>
                <button class="btn-close" id="close-habit-modal">&times;</button>
            </div>
            <form id="habit-form">
                <input type="hidden" id="habit-id">
                <div class="form-group">
                    <label for="habit-name">Habit Name</label>
                    <input type="text" id="habit-name" placeholder="Exercise daily" required>
                </div>
                <div class="form-group">
                    <label for="habit-frequency">Frequency</label>
                    <select id="habit-frequency">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="habit-target">Target per period</label>
                    <input type="number" id="habit-target" value="1" min="1" max="10">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-habit">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Habit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="smart-input-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-chat">
            <div class="modal-header">
                <h2>ü§ñ NovaDo AI</h2>
                <button class="btn-close" id="close-smart-modal">&times;</button>
            </div>
            <div class="smart-input-container">
                <div id="smart-chat" class="smart-chat">
                    <div class="chat-message assistant">
                        <div class="chat-avatar">ü§ñ</div>
                        <div class="chat-bubble">
                            Hi! I'm your AI assistant. I can help you create tasks using natural language. Try saying
                            something like:
                            <ul>
                                <li>"Remind me to call mom tomorrow at 3pm"</li>
                                <li>"Create an urgent task to review the report"</li>
                                <li>"Add a low priority task to water the plants weekly"</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <form id="smart-form" class="chat-input-form">
                    <input type="text" id="smart-input" placeholder="Describe your task..." autocomplete="off">
                    <button type="submit" class="btn btn-primary btn-send">
                        <span>‚û§</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Floating Sync Button (same style as old AI button) -->
    <button id="sync-fab-btn" class="ai-fab" title="Sync with Google Calendar (Ctrl+Shift+S)">
        <span class="ai-fab-icon">‚òÅÔ∏è</span>
        <span class="ai-fab-pulse"></span>
    </button>

    <!-- Context Menu for Sidebar Items -->
    <div id="context-menu" class="context-menu hidden">
        <button class="context-menu-item" data-action="rename">
            <span>‚úèÔ∏è</span> Rename
        </button>
        <button class="context-menu-item" data-action="duplicate">
            <span>üìã</span> Duplicate
        </button>
        <button class="context-menu-item" data-action="delete">
            <span>üóëÔ∏è</span> Remove
        </button>
    </div>

    <!-- Add Sidebar Item Modal -->
    <div id="add-sidebar-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="add-sidebar-title">Add Item</h2>
                <button class="btn-close" id="close-sidebar-modal">&times;</button>
            </div>
            <div class="sidebar-items-list" id="available-sidebar-items">
                <!-- Items will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="rename-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>Edit Item</h2>
                <button class="btn-close" id="close-rename-modal">&times;</button>
            </div>
            <form id="rename-form">
                <input type="hidden" id="rename-item-id">
                <input type="hidden" id="rename-item-type">
                <div class="form-group">
                    <label for="rename-input">Name</label>
                    <input type="text" id="rename-input" required>
                </div>
                <div class="form-group icon-picker-group">
                    <label for="rename-icon">Icon (Lucide icon name)</label>
                    <div class="icon-picker-row">
                        <div class="icon-preview" id="icon-preview">
                            <i data-lucide="inbox"></i>
                        </div>
                        <input type="text" id="rename-icon" placeholder="e.g. inbox, sun, star, heart">
                    </div>
                    <div class="icon-suggestions">
                        <button type="button" class="icon-btn" data-icon="inbox" title="inbox"><i
                                data-lucide="inbox"></i></button>
                        <button type="button" class="icon-btn" data-icon="sun" title="sun"><i
                                data-lucide="sun"></i></button>
                        <button type="button" class="icon-btn" data-icon="star" title="star"><i
                                data-lucide="star"></i></button>
                        <button type="button" class="icon-btn" data-icon="heart" title="heart"><i
                                data-lucide="heart"></i></button>
                        <button type="button" class="icon-btn" data-icon="folder" title="folder"><i
                                data-lucide="folder"></i></button>
                        <button type="button" class="icon-btn" data-icon="bookmark" title="bookmark"><i
                                data-lucide="bookmark"></i></button>
                        <button type="button" class="icon-btn" data-icon="flag" title="flag"><i
                                data-lucide="flag"></i></button>
                        <button type="button" class="icon-btn" data-icon="zap" title="zap"><i
                                data-lucide="zap"></i></button>
                        <button type="button" class="icon-btn" data-icon="target" title="target"><i
                                data-lucide="target"></i></button>
                        <button type="button" class="icon-btn" data-icon="calendar" title="calendar"><i
                                data-lucide="calendar"></i></button>
                        <button type="button" class="icon-btn" data-icon="clock" title="clock"><i
                                data-lucide="clock"></i></button>
                        <button type="button" class="icon-btn" data-icon="home" title="home"><i
                                data-lucide="home"></i></button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-rename">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script src="js/api.js?v=9"></script>
    <script src="js/notifications.js"></script>
    <script src="js/statistics.js?v=1"></script>
    <script src="js/taskMatrix.js?v=5"></script>
    <script src="js/app.js?v=29"></script>
</body>

</html>